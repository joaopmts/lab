from airflow.hooks.base import BaseHook
from pyspark.sql import SparkSession

class sparkhook(BaseHook):
    def __init__(self, appname="AirflowSession"):
        super().__init__()
        self.conn_id = "spark_default"
        self.app_name = appname

    def get_conn_s3a(self, dcp):
        conn = self.get_connection(self.conn_id)
        master = f"{conn.host}:{conn.port}"
        builder = SparkSession.builder.appName(self.app_name).master(master)
        builder = builder.config("spark.jars", dcp)
        builder = builder.config("spark.driver.extraClassPath", dcp)
        return builder.getOrCreate()
    
    def get_conn(self):
        conn = self.get_connection(self.conn_id)
        master = f"{conn.host}:{conn.port}"
        builder = SparkSession.builder.appName(self.app_name).master(master)
        return builder.getOrCreate()
    